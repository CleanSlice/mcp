---
id: setup-app-api
title: API Setup (App)
version: 1.0.0
last_updated: 2025-12-19

pattern: setup
complexity: intermediate
framework: nuxt
category: setup
applies_to: [frontend, app]

tags:
  - api
  - hey-api
  - openapi
  - swagger
  - api-client
  - code-generation

keywords:
  - hey-api openapi-ts
  - sdk generation
  - swagger client
  - api client
  - type-safe api
  - axios client

deprecated: false
experimental: false
production_ready: true
---

# API Setup (App)

> **The API slice generates a type-safe API client** from your backend's Swagger/OpenAPI specification. Using `@hey-api/openapi-ts`, it creates TypeScript services, types, and schemas that stay in sync with your NestJS API.

---

## Overview

The API slice provides **type-safe API integration**:

```
┌──────────────────────────────────────────────────────────────┐
│  API (NestJS)                                                 │
│                                                               │
│  swagger-spec.json  ◄─── Generated from @nestjs/swagger       │
│                                                               │
└──────────────────────────────────────────────────────────────┘
                               │
                               │  npm run build:api
                               │  (openapi-ts)
                               ▼
┌──────────────────────────────────────────────────────────────┐
│  APP (Nuxt)                                                   │
│                                                               │
│  slices/setup/api/                                            │
│  ├── data/repositories/api/                                   │
│  │   ├── client.gen.ts      ◄─── Axios client instance        │
│  │   ├── sdk.gen.ts         ◄─── Service classes              │
│  │   ├── types.gen.ts       ◄─── TypeScript interfaces        │
│  │   └── schemas.gen.ts     ◄─── JSON schemas                 │
│  ├── api.config.ts          ◄─── Client configuration         │
│  └── utils/                                                   │
│       └── handleApiAuthentication.ts                          │
│                                                               │
└──────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────┐
│  FEATURE SLICES                                               │
│                                                               │
│  import { AuthService, UserDto } from '#api/data';            │
│                                                               │
│  const response = await AuthService.login({ body: creds });   │
│                                                               │
└──────────────────────────────────────────────────────────────┘
```

---

## Critical Rules

### 1. Swagger Spec from Neighboring API Folder

For local development, the OpenAPI spec is read from the API project:

```
project/
├── api/
│   └── swagger-spec.json     # Generated by NestJS
├── app/
│   ├── openapi-ts.config.ts  # Points to ../api/swagger-spec.json
│   └── slices/setup/api/     # Generated SDK output
└── admin/
    └── openapi-ts.config.ts  # Can also point to ../api/swagger-spec.json
```

### 2. Generated Files are Auto-Generated

Never manually edit files in the `data/repositories/api/` folder:

```typescript
// data/repositories/api/sdk.gen.ts
// This file is auto-generated by @hey-api/openapi-ts  <-- DO NOT EDIT

export class AuthService {
  public static login<ThrowOnError extends boolean = false>(
    options: Options<LoginData, ThrowOnError>
  ) {
    // ...
  }
}
```

### 3. Use the `#api` Alias

```typescript
// CORRECT - Use alias
import { AuthService, UserDto } from '#api/data';

// WRONG - Relative paths
import { AuthService } from '../../../setup/api/data/repositories/api';
```

---

## File Location & Naming

```
slices/setup/api/
├── data/
│   ├── index.ts                    # Re-exports repositories
│   └── repositories/
│       ├── index.ts                # Re-exports api
│       └── api/                    # Generated SDK (DO NOT EDIT)
│           ├── client.gen.ts       # Axios client
│           ├── sdk.gen.ts          # Service classes
│           ├── types.gen.ts        # TypeScript types
│           ├── schemas.gen.ts      # JSON schemas
│           └── index.ts            # Barrel export
├── utils/
│   └── handleApiAuthentication.ts  # Auth helper
├── api.config.ts                   # Client configuration
├── nuxt.config.ts                  # Slice configuration
└── index.ts                        # Public exports

# Root config file
openapi-ts.config.ts                # Hey-API configuration
```

---

## Installation

### Install Dependencies

```bash
# Hey-API OpenAPI TypeScript generator
npm install -D @hey-api/openapi-ts

# Hey-API Axios client
npm install @hey-api/client-axios

# Axios and utilities
npm install axios
npm install -D axios-retry
```

---

## Complete Configuration Example

### `openapi-ts.config.ts` (Root)

```typescript
// @scope:app
// @layer:config
// @type:openapi-config

import { defineConfig } from '@hey-api/openapi-ts';

export default defineConfig({
  /**
   * Name of the generated client
   */
  name: 'ApiClient',

  /**
   * Path to the OpenAPI/Swagger specification
   * For local dev: points to neighboring api folder
   * For CI/CD: can be a URL or environment variable
   */
  input: '../api/swagger-spec.json',

  /**
   * Output directory for generated files
   */
  output: {
    format: 'prettier',
    lint: 'eslint',
    path: './slices/setup/api/data/repositories/api',
  },

  /**
   * Plugins configuration
   */
  plugins: [
    {
      /**
       * Use Axios as the HTTP client
       * runtimeConfigPath points to your custom configuration
       */
      name: '@hey-api/client-axios',
      runtimeConfigPath: './slices/setup/api/api.config.ts',
    },
    {
      /**
       * Generate TypeScript enums instead of unions
       */
      enums: 'typescript',
      name: '@hey-api/typescript',
    },
    {
      /**
       * Generate JSON schemas for validation
       */
      name: '@hey-api/schemas',
      type: 'json',
    },
    {
      /**
       * Generate SDK with class-based services
       * e.g., AuthService.login(), UsersService.getUsers()
       */
      name: '@hey-api/sdk',
      asClass: true,
    },
  ],
});
```

### `slices/setup/api/api.config.ts`

```typescript
// @scope:app
// @slice:setup/api
// @layer:config
// @type:api-config

import type { CreateClientConfig } from './data/repositories/api/client.gen';

/**
 * Client configuration factory
 * Called during client initialization
 */
export const createClientConfig: CreateClientConfig = (config) => ({
  ...config,
  baseURL: process.env.API_URL ?? 'http://localhost:3333',
});
```

### `slices/setup/api/nuxt.config.ts`

```typescript
// @scope:app
// @slice:setup/api
// @layer:config
// @type:nuxt-config

import { fileURLToPath } from 'url';
import { dirname } from 'path';

const currentDir = dirname(fileURLToPath(import.meta.url));

export default defineNuxtConfig({
  alias: {
    '#api': currentDir,
  },
});
```

### `slices/setup/api/utils/handleApiAuthentication.ts`

```typescript
// @scope:app
// @slice:setup/api
// @layer:utils
// @type:utility

import { client } from '../data/repositories/api/client.gen';

/**
 * Handle API authentication
 * @param token - Pass token to authenticate, or leave empty to logout
 */
export const handleApiAuthentication = (token?: string) => {
  if (token) {
    client.instance.defaults.headers.common['Authorization'] = `Bearer ${token}`;
  } else {
    delete client.instance.defaults.headers.common['Authorization'];
  }
};
```

### `slices/setup/api/data/index.ts`

```typescript
export * from './repositories';
```

### `slices/setup/api/data/repositories/index.ts`

```typescript
export * from './api';
```

### `slices/setup/api/index.ts`

```typescript
export * from './data';
```

---

## Environment Configuration

### `.env`

```bash
# API Base URL
API_URL=http://localhost:3333

# For production
# API_URL=https://api.yourapp.com
```

### `.env.example`

```bash
### API URLs ###
API_URL=http://localhost:3333
```

---

## Package.json Scripts

Add to your `package.json`:

```json
{
  "scripts": {
    "build:api": "openapi-ts",
    "dev": "npm run build:api && nuxt dev",
    "build": "npm run build:api && nuxt build"
  }
}
```

---

## Usage Examples

### Using Generated Services

```typescript
// Services are generated as classes with static methods
import { AuthService, UsersService, UserDto } from '#api/data';

// Login
const loginResponse = await AuthService.login({
  body: {
    email: 'user@example.com',
    password: 'password123',
  },
});

// Get current user
const meResponse = await AuthService.me();
const user: UserDto = meResponse.data?.data;

// Get all users
const usersResponse = await UsersService.getUsers({
  query: {
    page: 1,
    limit: 10,
  },
});
```

### Using in Stores

```typescript
// slices/user/auth/stores/auth.ts
import { defineStore } from 'pinia';
import { AuthService, AuthDto, LoginUserDto } from '#api/data';
import { handleApiAuthentication } from '#api/utils/handleApiAuthentication';

export const useAuthStore = defineStore('auth', {
  state: () => ({
    auth: null as AuthDto | null,
    loading: false,
  }),

  actions: {
    async login(credentials: LoginUserDto): Promise<boolean> {
      try {
        this.loading = true;
        const response = await AuthService.login({
          body: credentials,
        });

        const authData = response.data?.data;
        if (authData) {
          this.auth = authData;
          handleApiAuthentication(authData.accessToken);
          return true;
        }
        return false;
      } catch (e) {
        console.error('Login failed', e);
        return false;
      } finally {
        this.loading = false;
      }
    },

    logout() {
      this.auth = null;
      handleApiAuthentication(); // Clears auth header
    },
  },
});
```

### Using in Components

```vue
<script setup lang="ts">
import { UsersService, type UserDto } from '#api/data';

const users = ref<UserDto[]>([]);
const loading = ref(false);

async function fetchUsers() {
  loading.value = true;
  try {
    const response = await UsersService.getUsers();
    users.value = response.data?.data || [];
  } finally {
    loading.value = false;
  }
}

onMounted(fetchUsers);
</script>

<template>
  <div v-if="loading">Loading...</div>
  <ul v-else>
    <li v-for="user in users" :key="user.id">
      {{ user.name }} - {{ user.email }}
    </li>
  </ul>
</template>
```

### Error Handling

```typescript
import { AuthService } from '#api/data';
import { useErrorStore } from '@/slices/setup/error/stores/error';

async function login(email: string, password: string) {
  const errorStore = useErrorStore();

  try {
    const response = await AuthService.login({
      body: { email, password },
    });

    if (response.data?.data) {
      return response.data.data;
    }

    errorStore.setError('login', 'Invalid response from server');
    return null;
  } catch (error: any) {
    // API error response structure
    if (error.response?.data?.message) {
      errorStore.setError('login', error.response.data.message);
    } else {
      errorStore.setError('login', 'Login failed. Please try again.');
    }
    return null;
  }
}
```

---

## Generated SDK Structure

### Service Classes

Each API tag generates a service class:

| API Tag | Generated Class | Example Methods |
|---------|-----------------|-----------------|
| `Auth` | `AuthService` | `login()`, `register()`, `me()` |
| `Users` | `UsersService` | `getUsers()`, `getUser()`, `createUser()` |
| `Files` | `FilesService` | `uploadFile()`, `getFiles()`, `deleteFile()` |

### Type Exports

```typescript
// All types are exported from the SDK
import {
  // DTOs (Data Transfer Objects)
  UserDto,
  CreateUserDto,
  UpdateUserDto,
  LoginUserDto,
  RegisterUserDto,
  AuthDto,

  // Response types
  GetUsersResponse,
  GetUserResponse,
  LoginResponse,

  // Error types
  LoginError,
  RegisterError,

  // Enums
  UserRole,
  UserStatus,
} from '#api/data';
```

---

## Regenerating the SDK

### When to Regenerate

Run `npm run build:api` when:

- Backend API endpoints change
- DTOs are added or modified
- New controllers are added
- Swagger decorators are updated

### Development Workflow

```bash
# Terminal 1: Run API (generates swagger-spec.json on start)
cd api
npm run start:dev

# Terminal 2: Run App (regenerates SDK, then starts Nuxt)
cd app
npm run dev
```

### CI/CD Considerations

For CI/CD, you may want to fetch the spec from a URL:

```typescript
// openapi-ts.config.ts
export default defineConfig({
  input: process.env.SWAGGER_URL || '../api/swagger-spec.json',
  // ...
});
```

---

## Checklist

### Initial Setup

- [ ] Install `@hey-api/openapi-ts` and `@hey-api/client-axios`
- [ ] Create `openapi-ts.config.ts` in app root
- [ ] Create `slices/setup/api/` folder structure
- [ ] Create `api.config.ts` with base URL configuration
- [ ] Create `nuxt.config.ts` with `#api` alias
- [ ] Add `build:api` script to `package.json`
- [ ] Set `API_URL` in `.env`

### After API Changes

- [ ] Run `npm run build:api` to regenerate SDK
- [ ] Check for TypeScript errors from breaking changes
- [ ] Update component/store code if needed

### Never Do

- [ ] NO manual edits to `*.gen.ts` files
- [ ] NO hardcoding API URLs (use environment variables)
- [ ] NO importing from `./data/repositories/api` directly (use `#api/data`)
- [ ] NO committing generated files without regenerating after API changes

---

## Related Documentation

- [Store Setup](./app-store.md) - Pinia state management
- [Error Setup](./app-error.md) - Error handling patterns
- [Theme Setup](./app-theme.md) - UI components
- [API Swagger Setup](./api-swagger.md) - Backend Swagger configuration
